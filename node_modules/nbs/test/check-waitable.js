/*eslint-env mocha*/
/*eslint-disable strict, no-console*/

var assert = require('assert');

describe('check waitable', function(){
  var nbs = require('../index'), wait = nbs.wait, resume = nbs.resume;

  beforeEach(function(){
    nbs.resetConfig();
  });

  it('should check the fiber stack correctly', function(done){
    nbs.run(function(){
      assert.equal(nbs.waitable(), true);

      setTimeout(function(){
        assert.equal(nbs.waitable(), false);
        resume();
        assert.equal(nbs.waitable(), false);
      }, 0);
      wait();

      assert.equal(nbs.waitable(), true);

      done();
    }, done);
    assert.equal(nbs.waitable(), false);
  });
});